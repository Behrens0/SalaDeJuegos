import{a as U,b as q,e as B,m as Q}from"./chunk-DON5HI3A.js";import{a as G}from"./chunk-NWFSGMAH.js";import"./chunk-LJ5XHLMQ.js";import{C,F as l,H as r,I as a,J as d,K as P,L as g,M as m,O as k,P as T,Q as j,R as c,S as E,T as b,V as L,W as D,X as H,Z as u,_ as R,ga as N,ha as F,i as h,ia as A,ka as z,m as x,n as _,qa as V,ta as f,v as s,x as I,y as O,z as v}from"./chunk-CB2OHQ7B.js";import{h as p}from"./chunk-FK42CRUA.js";var $=["chatContainer"],y=o=>({dimmed:o}),K=(o,e)=>({"own-message":o,"other-message":e});function X(o,e){o&1&&(r(0,"div",9)(1,"label"),c(2,"INICI\xC1 SESI\xD3N PARA JUGAR"),a()())}function Y(o,e){if(o&1&&(r(0,"div",19),c(1),a()),o&2){let t=m().$implicit,n=m(2);s(),b(" ",n.formatDate(t.timestamp)," ")}}function Z(o,e){if(o&1&&(r(0,"div",16),C(1,Y,2,1,"div",17),r(2,"strong"),c(3),a(),r(4,"span",18),c(5),a(),c(6),a()),o&2){let t=e.$implicit,n=e.index,i=m(2);l("ngClass",R(5,K,t.user===i.username,t.user!==i.username)),s(),l("ngIf",i.isNewDay(n)),s(2),E(t.user),s(2),b("[",t.timestamp,"]"),s(),b(": ",t.text," ")}}function ee(o,e){if(o&1){let t=P();r(0,"div",10)(1,"h3"),c(2,"Chat"),a(),r(3,"div",11),C(4,Z,7,8,"div",12),a(),r(5,"div",13)(6,"input",14),H("ngModelChange",function(i){x(t);let S=m();return D(S.message,i)||(S.message=i),_(i)}),g("keyup.enter",function(){x(t);let i=m();return _(i.sendMessage())}),a(),r(7,"button",15),g("click",function(){x(t);let i=m();return _(i.sendMessage())}),c(8,"Enviar"),a()()()}if(o&2){let t=m();s(4),l("ngForOf",t.messages),s(2),L("ngModel",t.message)}}var M=class o{constructor(e,t){this.router=e;this.supabaseService=t}message="";messages=[];username="";isLoggedIn=!1;currentUserEmail="";chatContainer;ngOnInit(){return p(this,null,function*(){yield this.checkUserStatus(),yield this.loadMessages(),this.supabaseService.getUser().then(({data:e})=>{this.currentUserEmail=e?.user?.email??""}),this.supabaseService.listenToMessages(e=>{console.log("Callback de listenToMessages llamado con payload:",e);let t=e.new;if(!t){console.warn('Payload recibido sin propiedad "new":',e);return}console.log("Nuevo mensaje recibido:",t),this.messages.push({user:t.user,text:t.text,timestamp:new Date(t.timestamp).toLocaleTimeString([],{year:"2-digit",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),console.log("Mensaje agregado al array messages:",this.messages[this.messages.length-1]),this.scrollToBottom()})})}isNewDay(e){if(e===0)return!0;let t=new Date(this.messages[e].timestamp).toDateString(),n=new Date(this.messages[e-1].timestamp).toDateString();return t!==n}formatDate(e){let t={year:"numeric",month:"long",day:"numeric"};return console.log(e),new Date(e).toLocaleDateString("es-AR",t)}checkUserStatus(){return p(this,null,function*(){let{data:e,error:t}=yield this.supabaseService.getUser();console.log("checkUserStatus:",{data:e,error:t}),this.isLoggedIn=!!e?.user,console.log(this.isLoggedIn),this.username=e?.user?.email||""})}sendMessage(){return p(this,null,function*(){if(this.message.trim()&&this.isLoggedIn){let{error:e}=yield this.supabaseService.addMessage(this.username,this.message);e?console.error("Error al enviar mensaje:",e.message):(this.message="",yield this.loadMessages(),this.scrollToBottom())}})}loadMessages(){return p(this,null,function*(){let{data:e,error:t}=yield this.supabaseService.getMessages();!t&&e?(this.messages=e.map(n=>({user:n.user,text:n.text,timestamp:new Date(n.timestamp).toLocaleTimeString([],{year:"2-digit",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})})),this.scrollToBottom()):console.error("Error al obtener mensajes:",t?.message)})}scrollToBottom(){let e=document.querySelector(".chat-messages");e&&(e.scrollTop=e.scrollHeight)}navegarAGrupo(e){console.log("Intentando navegar a:",e,"isLoggedIn:",this.isLoggedIn),this.isLoggedIn&&this.router.navigate([`/${e}`])}static \u0275fac=function(t){return new(t||o)(I(V),I(G))};static \u0275cmp=O({type:o,selectors:[["app-home"]],viewQuery:function(t,n){if(t&1&&k($,5),t&2){let i;T(i=j())&&(n.chatContainer=i.first)}},standalone:!1,decls:20,vars:14,consts:[[1,"home-container"],[1,"games"],[1,"icon",3,"click","ngClass"],["src","https://lyotopwjahfarqruzrts.supabase.co/storage/v1/object/public/tomas//PreguntadosGame.jpg","alt","Icono 1"],["src","https://lyotopwjahfarqruzrts.supabase.co/storage/v1/object/public/tomas//ahorcado.png","alt","Icono 2"],["src","https://lyotopwjahfarqruzrts.supabase.co/storage/v1/object/public/tomas//mayormenor-removebg-preview.png","alt","Icono 3"],["src","https://lyotopwjahfarqruzrts.supabase.co/storage/v1/object/public/tomas//favicon.png","alt","Icono 4"],["class","mensaje-sesion",4,"ngIf"],["class","chat-container",4,"ngIf"],[1,"mensaje-sesion"],[1,"chat-container"],[1,"chat-messages"],["class","message",3,"ngClass",4,"ngFor","ngForOf"],[1,"input-container"],["type","text","placeholder","Escribe tu mensaje",3,"ngModelChange","keyup.enter","ngModel"],[3,"click"],[1,"message",3,"ngClass"],["class","fecha-separador",4,"ngIf"],[1,"hora"],[1,"fecha-separador"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2),g("click",function(){return n.isLoggedIn?n.navegarAGrupo("preguntados"):null}),d(3,"img",3),r(4,"label"),c(5,"Preguntados"),a()(),r(6,"div",2),g("click",function(){return n.isLoggedIn?n.navegarAGrupo("ahorcado"):null}),d(7,"img",4),r(8,"label"),c(9,"Ahorcado"),a()(),r(10,"div",2),g("click",function(){return n.isLoggedIn?n.navegarAGrupo("mayor-menor"):null}),d(11,"img",5),r(12,"label"),c(13,"Mayor o Menor"),a()(),r(14,"div",2),g("click",function(){return n.isLoggedIn?n.navegarAGrupo("gameOfThrones"):null}),d(15,"img",6),r(16,"label"),c(17,"Game Of Thrones"),a()()(),C(18,X,3,0,"div",7)(19,ee,9,2,"div",8),a()),t&2&&(s(2),l("ngClass",u(6,y,!n.isLoggedIn)),s(4),l("ngClass",u(8,y,!n.isLoggedIn)),s(4),l("ngClass",u(10,y,!n.isLoggedIn)),s(4),l("ngClass",u(12,y,!n.isLoggedIn)),s(4),l("ngIf",!n.isLoggedIn),s(),l("ngIf",n.isLoggedIn))},dependencies:[N,F,A,U,q,B],styles:[".home-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:60px;background-color:#fff;border-radius:10px;margin:70px}.games[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:60px;justify-content:center;flex-wrap:wrap}.icon[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;transition:transform .3s ease;cursor:pointer}.icon[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.icon[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:300px;height:250px;transition:opacity .3s ease;border-radius:10px}.icon[_ngcontent-%COMP%]:hover   img[_ngcontent-%COMP%]{transform:scale(1.1)}label[_ngcontent-%COMP%]{margin-top:15px;text-align:center;color:#000;font-size:20px;font-family:Roboto,sans-serif}.dimmed[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{opacity:.5;pointer-events:none}.mensaje-sesion[_ngcontent-%COMP%]{margin-top:10px;font-size:20px;text-align:center;font-family:Roboto,sans-serif}.chat-container[_ngcontent-%COMP%]{position:fixed;bottom:20px;left:50%;transform:translate(-50%);width:620px;height:430px;overflow:hidden;border-radius:12px;padding:15px;background-color:#f8f0ff;box-shadow:0 8px 16px #00000026;z-index:1000;display:flex;flex-direction:column;font-family:Arial,sans-serif;border:2px solid #7e57c2}.chat-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 10px;font-size:20px;color:#6a1b9a;text-align:center}.chat-messages[_ngcontent-%COMP%]{flex-grow:1;overflow-y:auto;margin-bottom:10px;padding:5px;background-color:#fff;border-radius:8px;border:1px solid #ccc}.chat-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;padding:7px;border:1px solid #ccc;border-radius:6px;font-family:Arial,sans-serif;font-size:14px;background-color:#fff}.chat-container[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]{display:flex;width:100%;gap:8px;align-items:center}.chat-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:7px 12px;background-color:#7e57c2;color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:14px;font-family:Arial,sans-serif}.chat-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#6a1b9a}.chat-container[_ngcontent-%COMP%]   div.message[_ngcontent-%COMP%]{margin:5px 0;padding:6px 10px;border-radius:6px;max-width:90%;align-self:flex-start;font-size:14px}.hora[_ngcontent-%COMP%]{color:#888;font-size:12px;margin-left:5px}.own-message[_ngcontent-%COMP%]{background-color:#c8e6c9;align-self:flex-start;text-align:left}.other-message[_ngcontent-%COMP%]{background-color:#e1bee7;align-self:flex-end;text-align:right}.fecha-separador[_ngcontent-%COMP%]{text-align:center;margin:10px 0;font-size:14px;font-weight:700;color:#666;background-color:#e0e0e0;padding:4px 8px;border-radius:8px}"]})};var te=[{path:"",component:M}],w=class o{static \u0275fac=function(t){return new(t||o)};static \u0275mod=v({type:o});static \u0275inj=h({imports:[f.forChild(te),f]})};var J=class o{static \u0275fac=function(t){return new(t||o)};static \u0275mod=v({type:o});static \u0275inj=h({imports:[z,Q,f,w]})};export{J as HomeModule};
