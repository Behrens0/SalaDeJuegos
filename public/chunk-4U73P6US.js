import{a as k}from"./chunk-NWFSGMAH.js";import"./chunk-LJ5XHLMQ.js";import{C as m,F as g,H as r,I as s,J as _,K as w,L as I,M as f,N as M,R as u,S as l,T as h,U as S,ha as E,i as b,ia as A,ka as O,m as j,n as x,t as P,ta as R,v as o,x as C,y as v,z as y}from"./chunk-CB2OHQ7B.js";import{h as c}from"./chunk-FK42CRUA.js";function N(n,e){if(n&1&&(r(0,"div",9),_(1,"img",10),r(2,"h2",11),u(3),s()()),n&2){let t=f();o(),M("alt","Imagen de ",t.nombreCategoria,""),g("src",t.imagenCategoria,P),o(2),l(t.nombreCategoria)}}function T(n,e){if(n&1){let t=w();r(0,"button",12),I("click",function(){let i=j(t).$implicit,p=f();return x(p.verificarRespuesta(i))}),u(1),s()}if(n&2){let t=e.$implicit;o(),h(" ",t," ")}}function D(n,e){if(n&1&&(r(0,"li"),u(1),s()),n&2){let t=e.$implicit;o(),S(" ",t.nombre," - ",t.puntaje," puntos ")}}var d=class n{constructor(e){this.supabaseService=e}preguntas=[];preguntaActual=null;respuestas=[];puntaje=0;mensaje="";imagenCategoria="";nombreCategoria="";preguntasRespondidas=[];mejoresJugadores=[];apiKey="$2b$12$OZ1B9NpVbw6wD1FV9xDKA.JMbZxZUvSLQtdHTxn/Vompf8IkMrLU2";ngOnInit(){this.cargarPreguntas(),this.obtenerRanking()}cargarPreguntas(){return c(this,null,function*(){try{let t=["sports%26leisure","arts%26literature","geography"].map(p=>fetch(`https://api.quiz-contest.xyz/questions?limit=10&page=1&category=${p}`,{headers:{Authorization:this.apiKey}})),a=yield Promise.all(t);if(a.some(p=>!p.ok))throw new Error("Error al cargar preguntas de una o m\xE1s categor\xEDas");let i=yield Promise.all(a.map(p=>p.json()));this.preguntas=i.flatMap(p=>p.questions),this.preguntas=this.mezclarPreguntas(this.preguntas),this.cambiarPregunta()}catch(e){this.mensaje=`Error al cargar preguntas: ${e instanceof Error?e.message:"Error desconocido"}`}})}mezclarPreguntas(e){return e.sort(()=>Math.random()-.5)}cambiarPregunta(){let e=this.preguntas.filter(t=>!this.preguntasRespondidas.includes(t.id));if(e.length>0){let t=Math.floor(Math.random()*e.length),a=e[t];this.preguntasRespondidas.push(a.id),this.preguntaActual=a,this.respuestas=[this.preguntaActual.correctAnswers,...this.preguntaActual.incorrectAnswers],this.respuestas=this.mezclarRespuestas(this.respuestas);let i=this.obtenerNombreCategoriaLegible(this.preguntaActual.category);this.nombreCategoria=i.nombre,this.imagenCategoria=i.imagen}else this.mensaje="\xA1No hay m\xE1s preguntas disponibles!"}mezclarRespuestas(e){return e.sort(()=>Math.random()-.5)}obtenerNombreCategoriaLegible(e){return{"sports&leisure":{nombre:"Deportes y Ocio",imagen:"https://lyotopwjahfarqruzrts.supabase.co/storage/v1/object/public/tomas//deportes.jpg"},"arts&literature":{nombre:"Artes y Literatura",imagen:"https://lyotopwjahfarqruzrts.supabase.co/storage/v1/object/public/tomas//artylit.jpg"},geography:{nombre:"Geograf\xEDa",imagen:"https://lyotopwjahfarqruzrts.supabase.co/storage/v1/object/public/tomas//geo.jpg"}}[e]||{nombre:e,imagen:"URL_IMAGEN_DEFAULT"}}verificarRespuesta(e){return c(this,null,function*(){console.log("Respuesta seleccionada:",e),console.log("Respuesta correcta:",this.preguntaActual.correctAnswers),e===this.preguntaActual.correctAnswers?(this.puntaje++,this.mensaje="\xA1Correcto! Tu puntaje es: "+this.puntaje,console.log("Respuesta correcta. Puntaje actualizado:",this.puntaje),this.cambiarPregunta()):(console.log("Respuesta incorrecta. Puntaje antes de guardar:",this.puntaje),this.mensaje="Incorrecto. La respuesta correcta era: "+this.preguntaActual.correctAnswers,yield this.guardarPuntaje(),this.puntaje=0,this.cambiarPregunta())})}guardarPuntaje(){return c(this,null,function*(){console.log("Iniciando guardado de puntaje...");let{data:e,error:t}=yield this.supabaseService.getUser(),a=e?.user?.email||"An\xF3nimo";console.log("Usuario:",a),console.log("Puntaje a guardar:",this.puntaje);let{error:i}=yield this.supabaseService.insertPuntajePreguntados({correo:a,puntaje:this.puntaje,fecha:new Date().toISOString()});i?(console.error("Error al guardar el puntaje:",i.message),this.mensaje="Error al guardar el puntaje. Intenta nuevamente."):(console.log("Puntaje guardado correctamente"),this.obtenerRanking())})}obtenerRanking(){return c(this,null,function*(){let{data:e,error:t}=yield this.supabaseService.getTopPreguntadosRanking(5);t?(console.error("Error al obtener ranking:",t.message),this.mensaje="Error al obtener el ranking. Intenta nuevamente."):this.mejoresJugadores=e.map(a=>({nombre:a.correo,puntaje:a.puntaje}))})}static \u0275fac=function(t){return new(t||n)(C(k))};static \u0275cmp=v({type:n,selectors:[["app-preguntados"]],standalone:!1,decls:15,vars:6,consts:[[1,"preguntados-container"],["class","categoria-info",4,"ngIf"],[1,"pregunta"],[1,"respuestas-container"],["class","respuesta-btn",3,"click",4,"ngFor","ngForOf"],[1,"puntos"],[1,"mensaje"],[1,"ranking-container"],[4,"ngFor","ngForOf"],[1,"categoria-info"],[1,"categoria-imagen",3,"src","alt"],[1,"categoria"],[1,"respuesta-btn",3,"click"]],template:function(t,a){t&1&&(r(0,"div",0),m(1,N,4,4,"div",1),r(2,"h2",2),u(3),s(),r(4,"div",3),m(5,T,2,1,"button",4),s(),r(6,"p",5),u(7),s(),r(8,"p",6),u(9),s(),r(10,"div",7)(11,"h3"),u(12,"TOP 5:"),s(),r(13,"ul"),m(14,D,2,2,"li",8),s()()()),t&2&&(o(),g("ngIf",a.nombreCategoria&&a.imagenCategoria),o(2),l(a.preguntaActual==null?null:a.preguntaActual.question),o(2),g("ngForOf",a.respuestas),o(2),h("Puntaje: ",a.puntaje,""),o(2),l(a.mensaje),o(5),g("ngForOf",a.mejoresJugadores))},dependencies:[E,A],styles:[".preguntados-container[_ngcontent-%COMP%]{text-align:center;max-width:900px;margin:150px auto;padding:20px;border:2px solid #007bff;border-radius:10px;background-color:#f9f9f9;font-family:Roboto,sans-serif}.pregunta[_ngcontent-%COMP%]{font-size:24px;font-weight:700;margin-bottom:20px}.respuestas-container[_ngcontent-%COMP%]{margin-top:20px}.respuesta-btn[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;padding:10px 20px;border:none;border-radius:5px;cursor:pointer;margin:5px}.respuesta-btn[_ngcontent-%COMP%]:hover{background-color:#0056b3}.puntos[_ngcontent-%COMP%]{margin-top:20px;font-size:18px;font-weight:700}.mensaje[_ngcontent-%COMP%]{margin-top:20px;font-size:20px;color:#d9534f}.categoria[_ngcontent-%COMP%]{font-size:20px;margin-bottom:20px;color:#4caf50}.categoria-imagen[_ngcontent-%COMP%]{width:400px;height:auto}"]})};var L=[{path:"",component:d}],z=class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=y({type:n});static \u0275inj=b({imports:[O,R.forChild(L)]})};export{z as PreguntadosModule};
